var app=app||{};app.TextIntegratedView=Backbone.View.extend({el:"#treatment-text-integrated",events:{"click #instruction-read":"renderEditor","click #help":"renderInstructionModal","click #editor-button":"analyzeText","click #editor-full-button":"saveText"},initialize:function(){var e=this;this.prePageDurationStart=null,this.postPageDurationStart=null,this.colors=d3.scaleOrdinal(d3.schemeCategory10),this.userModel=new app.UserSpecificModel,this.textModel=new app.TextModelComplete,this.analyzer=new app.TextAnalyzerModel,this.userModel.fetch({success:function(t,n){e.renderInstruction()},error:function(e,t){console.log(t)}})},renderInstruction:function(){this.$el.html(Handlebars.templates.instruction({instruction:this.userModel.get("instruction")}))},renderEditor:function(){this.prePageDurationStart=new Date,this.$el.html(Handlebars.templates.editor());var e=new MediumEditor("#editor-textinput",{toolbar:!1,placeholder:!1});$("#editor-textinput").html("<p>Schreibe hier ...</p>");var t=document.querySelector("#editor-textinput").firstChild;e.selectElement(t),this.$el.append('<i id="help" class="material-icons">help</i>'),this.$el.append(Handlebars.templates["modal-help"]({instruction:this.userModel.get("instruction")}))},renderInstructionModal:function(){$("#modal-help").openModal()},analyzeText:function(){var e=this;app.regExText("#editor-textinput");var t=app.getParagraphs(this.$el.find("#editor-textinput")),n=app.getPlainText(this.$el.find("#editor-textinput"));if(t.length<300)Materialize.toast("Ihr Text ist leider zu kurz.",4e3);else{var i=(new Date-this.prePageDurationStart)/1e3;this.postPageDurationStart=new Date,this.textModel.set({pre_page_duration:i,pre_text:n}),this.$el.find("#editor-button-div").html(Handlebars.templates["loading-ring"]()),this.analyzer.set({text:t}),this.analyzer.save(null,{success:function(t){e.renderRevision()},error:function(e,t){console.log(t.responseText)}})}},renderRevision:function(){var e=this;this.$el.find("#editor-button-div").html('<a class="waves-effect waves-light btn" id="save-text">Text abschicken</a>'),this.textModel.set({pre_num_sentences:this.analyzer.get("numSentences"),pre_num_clusters:this.analyzer.get("numCluster"),pre_num_coherent_sentences:this.analyzer.get("cohSentences"),pre_num_non_coherent_sentences:this.analyzer.get("cohNotSentences"),pre_num_concepts:this.analyzer.get("numConcepts"),pre_local_cohesion:this.analyzer.get("local cohesion")}),this.paragraphs=$("#editor-textinput").html(),this.$el.html(Handlebars.templates["double-text-editor"]),$("#editor-edit").html(this.paragraphs),$("#editor-visualize-text").html(this.paragraphs),this.$el.append('<i id="help" class="material-icons">help</i>'),this.$el.append(Handlebars.templates["modal-help"]({instruction:this.userModel.get("instructionreview")})),app.highlightWholeText("#editor-visualize-text",this.analyzer.get("clusters"),e.colors);new MediumEditor("#editor-edit",{toolbar:!1});$("#editor-full-button").text("Text abschicken"),this.$el.append(Handlebars.templates["modal-revision"]({instruction:this.userModel.get("instructionreview")})),$("#modal-revision").openModal()},printText:function(){},saveText:function(){var e=this,t=(new Date-this.postPageDurationStart)/1e3;this.$el.find("#editor-full-button-div").html(Handlebars.templates["loading-ring"]());var n=app.getParagraphs(this.$el.find("#editor-edit")),i=app.getPlainText(this.$el.find("#editor-edit"));console.log(i),this.textModel.set({post_text:i,post_page_duration:t}),this.analyzer.set({text:n}),this.analyzer.save(null,{success:function(t){e.sendToServer()},error:function(e,t){console.log(t.responseText)}})},sendToServer:function(){this.textModel.set({post_num_sentences:this.analyzer.get("numSentences"),post_num_clusters:this.analyzer.get("numCluster"),post_num_coherent_sentences:this.analyzer.get("cohSentences"),post_num_non_coherent_sentences:this.analyzer.get("cohNotSentences"),post_num_concepts:this.analyzer.get("numConcepts"),post_local_cohesion:this.analyzer.get("local cohesion")}),this.textModel.save(null,{success:function(e){location.reload()},error:function(e,t){console.log("error")}})}}),new app.TextIntegratedView;
//# sourceMappingURL=text-integrated.js.map
